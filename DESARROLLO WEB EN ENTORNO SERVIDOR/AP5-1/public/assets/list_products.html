<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listado de Productos</title>
</head>
<body>
<h1>Listado de Productos</h1>
<nav>
    <a href="/">Inicio</a> |
    <a href="/clientes">Clientes</a> |
    <a href="/pedidos">Pedidos</a> |
    <a href="/productos">Productos</a>
</nav>
<hr>
<p><a href="/producto/create">âž• Crear Nuevo Producto</a></p>
<table border="1">
    <tr>
        <th>ID Producto</th>
        <th>DescripciÃ³n</th>
        <th>Pedidos Relacionados</th>
        <th>Acciones</th>
    </tr>
    <?php if (empty($products)): ?>
    <tr>
        <td colspan="4">No hay productos registrados</td>
    </tr>
    <?php else: ?>
    <?php foreach ($products as $product): ?>
    <tr>
        <td><?php echo htmlspecialchars($product->getId()) ?></td>
        <td><?php echo htmlspecialchars($product->getDescription()) ?></td>
        <td>
            <?php
        // Obtener pedidos Ãºnicos relacionados con este producto
        $orderIds = [];
        foreach ($product->getDetails() as $detail) {
            $orderId = $detail->getOrder()->getId();
            if (!in_array($orderId, $orderIds)) { ?>
            <a href="/pedido/read/<?php echo $orderId ?>"><?php echo $orderId ?></a>
            <?php
            }
            }
            ?>
        </td>
        <td>
            <a href="/producto/update/<?php echo $product->getId() ?>">Actualizar</a> |
            <a href="/producto/delete/<?php echo $product->getId() ?>">Eliminar</a>
        </td>
    </tr>
    <?php endforeach; ?>
    <?php endif; ?>
</table>
</body>
</html>




<!--
    Codigo comentado
-->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!--
        ðŸ“Œ Hace que la pÃ¡gina sea "responsive" en mÃ³viles,
        ajustando el ancho al tamaÃ±o de la pantalla.
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--
        TÃ­tulo que aparece en la pestaÃ±a del navegador.
        âœ… Para otro proyecto: cambia "Productos" por el nombre de la entidad.
    -->
    <title>Listado de Productos</title>
</head>
<body>

<!--
    TÃ­tulo principal de la pÃ¡gina.
    âœ… Para otro proyecto: "Listado de Usuarios", "Listado de Pedidos", etc.
-->
<h1>Listado de Productos</h1>

<!--
    MenÃº de navegaciÃ³n sencillo.
    Cada enlace apunta a una ruta que el sistema de routing debe conocer.
    âœ… Para reaprovechar:
       - Cambia las rutas segÃºn el enunciado (por ejemplo /usuarios, /facturasâ€¦)
-->
<nav>
    <a href="/">Inicio</a> |
    <a href="/clientes">Clientes</a> |
    <a href="/pedidos">Pedidos</a> |
    <a href="/productos">Productos</a>
</nav>

<hr>

<!--
    Enlace para ir a la acciÃ³n de creaciÃ³n de un nuevo producto.
    Normalmente esta ruta estÃ¡ asociada a ProductController->crud('create')
-->
<p>
    <a href="/producto/create">âž• Crear Nuevo Producto</a>
</p>

<!--
    Tabla que muestra el listado de productos.
    border="1" es puramente visual para darle borde a las celdas.
-->
<table border="1">
    <!--
        Fila de cabecera de la tabla.
        âœ… Para otro proyecto, cambia estos <th> por los campos de la entidad:
           - ID Usuario, Nombre, Email, Rol, etc.
    -->
    <tr>
        <th>ID Producto</th>
        <th>DescripciÃ³n</th>
        <th>Pedidos Relacionados</th>
        <th>Acciones</th>
    </tr>

    <!--
        ComprobaciÃ³n: si NO hay productos en la colecciÃ³n/array $products,
        mostramos una fila con un mensaje y salimos.
        - empty($products) => true si es [], null, etc.
    -->
    <?php if (empty($products)): ?>
    <tr>
        <!--
            colspan="4" porque la tabla tiene 4 columnas en total.
            Si aÃ±ades mÃ¡s columnas, recuerda ajustar este valor.
        -->
        <td colspan="4">No hay productos registrados</td>
    </tr>

    <?php else: ?>

    <!--
        Recorremos el array/colecciÃ³n de productos.
        - $products viene desde el controlador ProductController->list()
        - Cada $product es un objeto de la entidad Product.
        âœ… Para otro proyecto: cambia "$product" y getters por la entidad correspondiente.
    -->
    <?php foreach ($products as $product): ?>
    <tr>
        <!--
            htmlspecialchars() protege contra XSS y muestra caracteres especiales correctamente.
            SIEMPRE es buena prÃ¡ctica al imprimir datos que vienen "dinÃ¡micos".
        -->

        <!-- ID del producto -->
        <td><?php echo htmlspecialchars($product->getId()) ?></td>

        <!-- DescripciÃ³n del producto -->
        <td><?php echo htmlspecialchars($product->getDescription()) ?></td>

        <!--
            Columna de "Pedidos Relacionados":
            AquÃ­ se muestra una lista de pedidos en los que aparece ese producto.
            Se asume una relaciÃ³n:
                Product 1 --- * Detail * --- 1 Order
            donde:
                - $product->getDetails() devuelve los "detalles de pedido" asociados.
                - Cada detalle tiene un ->getOrder() que devuelve el pedido.
        -->
        <td>
            <?php
            // Array para ir guardando los IDs de pedido ya mostrados.
            // Sirve para evitar duplicar enlaces si un mismo pedido tiene
            // varias lÃ­neas de detalle para el mismo producto.
            $orderIds = [];

            // Recorremos todos los detalles del producto.
            foreach ($product->getDetails() as $detail) {
            // Obtenemos el ID del pedido asociado a ese detalle.
            $orderId = $detail->getOrder()->getId();

            // Si todavÃ­a NO hemos mostrado este pedido, lo mostramos ahora.
            if (!in_array($orderId, $orderIds)) {
            // Guardamos el ID en el array para no repetirlo mÃ¡s adelante.
            $orderIds[] = $orderId;
            ?>
            <!--
                Enlace a la ruta que muestra la informaciÃ³n de un pedido concreto.
                Se asume una ruta tipo: /pedido/read/{id}
                âœ… Para otro proyecto:
                   - Cambia "pedido" por la entidad que quieras enlazar.
            -->
            <a href="/pedido/read/<?php echo $orderId ?>">
                <?php echo htmlspecialchars($orderId) ?>
            </a>
            <?php
                }
            }
            ?>
        </td>

        <!--
            Columna de acciones sobre cada producto:
            - Actualizar: lleva al formulario de ediciÃ³n.
            - Eliminar: lleva a la pantalla de confirmaciÃ³n de borrado.
            Estas rutas se asocian a ProductController->crud('update', $id)
            y ProductController->crud('delete', $id)
        -->
        <td>
            <!-- Enlace para actualizar el producto concreto -->
            <a href="/producto/update/<?php echo $product->getId() ?>">Actualizar</a> |

            <!-- Enlace para eliminar el producto concreto -->
            <a href="/producto/delete/<?php echo $product->getId() ?>">Eliminar</a>
        </td>
    </tr>
    <?php endforeach; ?>
    <?php endif; ?>
</table>
</body>
</html>
